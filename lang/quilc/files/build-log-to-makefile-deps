#!/bin/sh

set -e

BUILD_LOG=$1

echo "MASTER_SITES_DEPS= \\"
cat ${BUILD_LOG} | \
	grep -a "^; Fetching #<URL " | \
	sed -E 's|^; Fetching #<URL "|| ; s|">$$||' | \
	sort | \
	sed -E 's|^(http://beta.quicklisp.org/.*/)([^/]+)$$|\1:\2|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|.*|& \\|'
echo ""

echo "DISTFILES_DEPS= \\"
cat ${BUILD_LOG} | \
	grep -a "^; Fetching #<URL " | \
	sed -E 's|^; Fetching #<URL "|| ; s|">$$||' | \
	sort | \
	sed -E 's|^(http://beta.quicklisp.org/.*/)([^/]+)$$|\2:\2|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|^(.+):([^:-\+\.]*)[-\+\.]([^:]*)$|\1:\2_\3|' | \
	sed -E 's|.*|& \\|'
